好的，这是一个非常详尽的文档。命令确实非常多，进行分类整理是非常有必要的。

我将按照功能逻辑，将所有命令和概念重新组织和分类，以便于理解和查阅。

---

# RedLang 语法参考手册 (整理版)

RedLang 是一种为文本生成和自动化任务设计的简单而强大的脚本语言。它由一系列命令组成，旨在轻松处理文本、文件、网络请求和图像等。

**核心信息:**

*   **作者QQ：** `1875159423`
*   **QQ群：** `556515826`
*   **开源地址：** [https://github.com/super1207/redreply](https://github.com/super1207/redreply)
*   **开源协议：** AGPL

**注意：** 项目仍在快速迭代中，所有规则都可能发生变化。

如果你感觉此文档太过简洁，下面有个复杂点的文档：[真人版](/detailref/README.md)

---

## 一、 核心概念

### 1.1 基本语法

*   **命令格式：** `【命令名@参数1@参数2@...】`
    *   命令名和参数由 `@` 分割。
    *   如果命令名后紧跟另一个命令，`@` 可以省略，如 `【命令名【子命令...】】`。
    *   内置命令名不区分大小写和简繁体，但参数通常区分。
*   **转义规则：** 在字符串字面量中，使用 `\` 来转义特殊字符：`@`, `【`, `】`, `\`。
*   **空格与换行：** 字面量中的空格和换行会被忽略，需使用 `【空格】` 和 `【换行】` 命令。也可以用 `\ ` 来转义一个空格。
*   **原始字符串：** 使用 `【@内容】` 来表示原始内容，其中的空格、换行不会被忽略，`\` 也不再是转义符。`内容`中的 `【` 和 `】` 必须成对出现。
*   **注释：** 使用 `##` 来注释从该符号到行尾的内容。`##` 的优先级高于原始字符串。若要输出 `##`，请使用 `\##`。

### 1.2 数据类型

*   **文本 (T)：** UTF-8 字符串，是唯一可直接输出的类型。
*   **对象 (O)：** 键值对集合（字典或 Map）。
*   **数组 (A)：** 有序的元素列表。
*   **字节集 (B)：** 二进制数据。
*   **函数 (F)：** 可被赋值和调用的代码块。

### 1.3 作用域

*   **全局作用域：** 默认的作用域。
*   **函数作用域：** 只有调用函数 (`【调用函数】`) 会创建新的局部作用域。
*   **常量：** 使用 `【定义常量】` 定义的常量可以跨脚本访问。

---

## 二、 命令分类参考

### 1. 基础与核心

| 命令 | 说明 |
| :--- | :--- |
| `【换行】` | 插入一个换行符 (`\n`)。 |
| `【回车】` | 插入一个回车符 (`\r`)。 |
| `【空格】` | 插入一个空格。 |
| `【隐藏@内容】` | 执行内容但隐藏其输出，结果可由 `【传递】` 取出。 |
| `【传递】` | 获取最近一次由 `【隐藏】` 命令隐藏的内容。 |
| `【屏蔽@内容】` | 完全隐藏内容的输出，结果不可恢复。 |
| `【打印日志@文本】` | 在控制台输出Debug级别的日志。 |
| `【延时@毫秒数】` | 暂停脚本执行指定的毫秒数。 |
| `【当前版本】` | 返回红色问答的当前版本号。 |
| `【错误信息】` | 在“脚本错误”事件中，获取具体的错误信息。 |

### 2. 变量与状态管理

| 命令 | 说明 |
| :--- | :--- |
| `【定义变量@变量名@值】` | 在当前作用域定义一个新变量，若已存在则覆盖。 |
| `【变量@变量名】` | 获取最近作用域中的变量值，不存在则返回空文本。 |
| `【赋值变量@变量名@值】` | 修改最近作用域中的变量值，若不存在则在当前作用域创建。 |
| `【自增@变量名@增加数】` | 对一个数字变量进行增加操作，增加数默认为1。 |
| `【定义常量@名@内容】` | 定义一个全局常量，在所有脚本中可见。 |
| `【常量@名】` / `【常量@包名@名】` | 读取一个常量。 |
| `【定义临时常量@名@内容@有效时间】` | 定义一个带有时效的全局常量（单位：毫秒）。 |
| `【临时常量@名】` | 读取一个临时常量，过期或不存在则返回空文本。 |
| `【定义持久常量@名@内容】` | 定义一个持久化常量，同包内可见，重启不丢失。 |
| `【持久常量@名@默认值】` | 读取一个持久化常量，不存在则返回默认值。 |
| `【入栈@内容】` | 将内容压入一个全局栈。 |
| `【出栈】` | 从栈中弹出一个内容。 |
| `【栈顶@序号】` | 查看栈中指定位置的元素（0为栈顶）。 |
| `【序号@key@value】` | 设置或获取并递增一个全局序号。 |

### 3. 流程控制

| 命令 | 说明 |
| :--- | :--- |
| `【判等@文本1@文本2@不同执行@相同执行】` | 比较两个文本是否相等，并执行相应逻辑。 |
| `【判断@...】` | 功能同 `【判等】`。 |
| `【判真@文本@不为真执行@为真执行】` | 判断一个文本是否为“真”，并执行相应逻辑。 |
| `【判空@内容@为空替换】` | 如果内容为空，则返回替换值，否则返回原内容。 |
| `【选择@数字@内容0@内容1...】` | 根据数字选择要执行的内容。数字为空则随机选择。 |
| `【逻辑选择@逻辑数组@内容1@内容2...】` | 根据逻辑数组中第一个“真”的位置选择要执行的内容。 |
| `【循环@次数/数组/对象@循环体/处理函数】` | 执行固定次数循环，或遍历数组/对象。 |
| `【判循@循环条件@循环语句】` | 当循环条件为“真”时，持续执行循环。 |
| `【跳出】` | 终止并跳出当前循环 (break)。 |
| `【继续】` | 跳过本次循环的剩余部分，开始下一次循环 (continue)。 |
| `【返回】` | 跳出当前作用域（函数或整个脚本）。 |

### 4. 函数与命令定义

| 命令 | 说明 |
| :--- | :--- |
| `【函数定义@函数体】` | 定义一个函数，通常赋值给变量。 |
| `【调用函数@函数@参数1...】` | 调用一个函数，并创建新的作用域。 |
| `【参数@序号】` | 在函数或命令中，获取第 N 个参数（从1开始）。 |
| `【参数个数】` | 在函数或命令中，获取传入参数的总数。 |
| `【闭包@语句】` | 在函数定义时捕获外部变量。 |
| `【定义命令@名@内容】` | 定义一个全局自定义命令（参数会提前求值）。 |
| `【定义二类命令@名@内容】` | 定义一个全局自定义命令（参数不提前求值）。 |
| `【二类参数@序号】` | 在二类命令中，获取并求值第 N 个参数。 |
| `【复制命令@旧命令名@新命令名】` | 复制一个内置命令为新的命令。 |

### 5. 数据结构操作

#### 5.1 通用操作

| 命令 | 说明 |
| :--- | :--- |
| `【取长度@内容】` | 获取文本/数组/对象/字节集的长度。 |
| `【取类型@内容】` | 返回内容的类型标识（T/A/O/B/F）。 |
| `【翻转@内容】` | 翻转文本、数组或字节集。 |

#### 5.2 文本操作

| 命令 | 说明 |
| :--- | :--- |
| `【分割@文本@分割符】` | 将文本按分割符分割成数组。 |
| `【合并@数组@中间符号】` | 将数组元素用符号连接成一个文本。 |
| `【取中间@文本@开始@结束】` | 查找并返回位于两个标记之间的所有文本（数组形式）。 |
| `【截取@文本@开始位置@长度】` | 截取文本的一部分。 |
| `【文本替换@文本@旧@新】` | 替换文本中的指定内容。 |
| `【文本查找@文本@子文本@开始位置】` | 查找子文本在文本中的位置，返回索引或-1。 |
| `【去除开始/结尾/两边空白@文本】` | 去除文本首、尾或两端的空白字符。 |
| `【转大写@文本】` / `【转小写@文本】` | 转换文本的大小写。 |
| `【转繁体@文本】` / `【转简体@文本】` | 进行简繁体转换。 |
| `【判含@被判断文本@被包含文本@...】` | 判断一个文本是否包含另一个文本。 |

#### 5.3 数组与对象操作

| 命令 | 说明 |
| :--- | :--- |
| `【数组@元素1@元素2...】` | 创建一个数组。 |
| `【对象@键1@值1@键2@值2...】` | 创建一个对象。 |
| `【增加元素@变量名@元素...】` | 向数组、对象、文本或字节集添加元素。 |
| `【替换元素@变量名@下标@值】` | 替换指定位置的元素。 |
| `【删除元素@变量名@下标】` | 删除指定位置的元素。 |
| `【取元素@内容@下标...】` | 从数组、对象或文本中获取元素。 |
| `【取变量元素@变量名@下标】` | 功能同上，但操作对象是变量。 |
| `【取对象key@对象】` | 获取一个对象所有的键，返回数组。 |
| `【随机取@数组@为空替换】` | 从数组中随机取一个元素。 |
| `【数组查找@数组@元素@开始位置】` | 查找元素在数组中的位置，返回索引或-1。 |
| `【去重@数组】` | 移除数组中的重复元素。 |
| `【打乱@数组】` | 随机打乱数组元素的顺序。 |
| `【排序@数组@比较函数】` | 对数组进行排序。 |
| `【排列@数组@选取数】` | 计算数组元素的所有排列。 |
| `【组合@数组@选取数】` | 计算数组元素的所有组合。 |
| `【计数@内容@元素】` | 计算元素在文本、字节集或数组中出现的次数。 |

### 6. 数学与逻辑

| 命令 | 说明 |
| :--- | :--- |
| `【计算@表达式】` | 执行数学（+ - * / % // ^）和逻辑（== != > < >= <= && \|\| !）运算。 |
| `【取随机数@下限@上限】` | 生成一个指定范围内的随机整数。 |
| `【补位@数字@格式】` | 按指定格式补零或对齐小数。 |
| `【进制转换@数字@原进制@目标进制】` | 在2-16进制之间转换数字。 |
| `【数字转字符@数字】` | 将1-127的数字转为ASCII字符。 |
| `【区间选择@区间对象@数字】` | 根据数字在哪个区间，返回对应的值。 |
| `【骰@onedice参数】` | 模拟掷骰子，如 `3d6`。 |

### 7. 正则表达式

| 命令 | 说明 |
| :--- | :--- |
| `【正则@文本@表达式】` | 用正则表达式匹配文本，返回二维数组结果。 |
| `【正则判含@文本/数组@表达式...】` | 判断文本是否匹配正则，或筛选数组中匹配的元素。 |
| `【正则替换@文本@表达式@新文本】` | 使用正则表达式进行查找和替换。 |

### 8. 编码与格式转换

| 命令 | 说明 |
| :--- | :--- |
| `【转文本@内容@编码】` | 将对象/数组转为JSON，或将字节集按指定编码转为文本。 |
| `【转字节集@文本@编码】` | 将文本按指定编码转换为字节集。 |
| `【Json解析@Json内容@jsonpath】` | 解析JSON文本或字节集，返回RedLang对象/数组。 |
| `【HTML解析@HTML内容@CSS选择器】` | 解析HTML，根据CSS选择器提取元素信息。 |
| `【编码@内容】` / `【解码@内容】` | URL编码和解码。 |
| `【BASE64编码@字节集】` / `【BASE64解码@文本】` | Base64编解码。 |
| `【GZIP编码@字节集】` / `【GZIP解码@字节集】` | Gzip编解码。 |
| `【ZLIB编码@字节集】` / `【ZLIB解码@字节集】` | Zlib编解码。 |
| `【MD5编码@字节集】` | 计算字节集的MD5值（小写）。 |
| `【RCNB编码@字节集】` | RCNB编码。 |

### 9. 文件与目录操作

| 命令 | 说明 |
| :--- | :--- |
| `【读文件@路径】` | 读取文件内容，返回字节集。 |
| `【写文件@路径@内容】` | 写入文件，会覆盖原有内容。 |
| `【追加文件@路径@内容】` | 向文件末尾追加内容。 |
| `【删除文件@路径】` | 删除指定文件。 |
| `【读目录@路径】` / `【读目录文件@路径】` | 读取目录下所有项或仅文件，返回绝对路径数组。 |
| `【创建目录@路径】` | 创建目录，支持多级创建。 |
| `【删除目录@路径】` | 删除指定目录。 |
| `【判存@路径@不存在执行】` | 判断文件或目录是否存在。 |
| `【文件信息@路径】` | 获取文件或目录的元数据（大小、时间等）。 |
| `【应用目录】` | 返回当前包的`script.json`所在目录。 |
| `【运行目录】` | 返回主程序可执行文件所在目录。 |
| `【目录分隔符】` | 返回当前系统的路径分隔符 (`\` 或 `/`)。 |

### 10. INI 配置文件操作

| 命令 | 说明 |
| :--- | :--- |
| `【读配置@路径/字节集@节@键】` | 读取INI配置项的值。 |
| `【读配置节@路径/字节集】` | 读取INI所有的节名，返回数组。 |
| `【读配置键@路径/字节集@节】` | 读取INI指定节下所有的键值对，返回对象。 |
| `【写配置@路径@节@键@值】` | 写入一个INI配置项。 |

### 11. 网络操作

#### 11.1 HTTP 请求

| 命令 | 说明 |
| :--- | :--- |
| `【访问@网址】` | 发起GET请求，返回字节集。 |
| `【POST/GET/PUT/DELETE/PATCH访问@网址@访问体】` | 发起指定方法的HTTP请求。 |
| `【设置访问头@键@值】` | 设置后续HTTP请求的Header。 |
| `【返回头】` / `【返回头@小写key】` | 获取上一次HTTP请求的响应头。 |
| `【设置代理@代理地址】` | 设置后续HTTP请求的代理。 |
| `【系统代理】` / `【IE代理】` | 获取系统或IE设置的代理地址 (Windows)。 |
| `【github代理】` | 获取一个可用的GitHub代理地址。 |
| `【设置访问超时@毫秒数】` | 设置后续HTTP请求的超时时间。 |

#### 11.2 Web 浏览器模拟 (需安装Chrome)

| 命令 | 说明 |
| :--- | :--- |
| `【设置浏览器宽高@宽@高】` | 设置模拟浏览器的视口大小。 |
| `【网页截图@网址@CSS选择器】` | 使用无头浏览器对网页或指定元素截图。 |
| `【网页获取@网址@CSS选择器】` | 获取网页或元素的outerHTML。 |
| `【网页获取文本@网址@CSS选择器】` | 获取网页或元素的innerText。 |

### 12. 图像处理

| 命令 | 说明 |
| :--- | :--- |
| **基础操作** | |
| `【创建图片@宽@高@rgba数组】` | 创建一张纯色图片。 |
| `【图片信息@图片字节集】` | 获取图片的宽、高、格式。 |
| `【图片大小调整@图@宽@高】` | 调整图片尺寸。 |
| `【图片截取@图@x@y@w@h】` | 截取图片的一部分。 |
| **合成与拼接** | |
| `【图片叠加@大图@小图@x@y】` | 将小图放在大图下方进行叠加。 |
| `【图片上叠加@大图@小图@x@y】` | 将小图放在大图上方，带透明度混合。 |
| `【图片覆盖@大图@小图@x@y】` | 将小图直接覆盖在大图上，不混合透明度。 |
| `【图片拼接@左图@右图】` | 水平拼接两张图片。 |
| `【图片竖拼接@上图@下图】` | 垂直拼接两张图片。 |
| **变换与滤镜** | |
| `【透视变换@图@目标点@原点】` | 对图片进行透视变换。 |
| `【水平翻转@图】` / `【垂直翻转@图】` | 翻转图片。 |
| `【图片旋转@图@角度】` | 旋转图片（尺寸不变）。 |
| `【完整图片旋转@图@角度】` | 旋转图片并调整尺寸以完整显示。 |
| `【图片模糊@图@sigma】` / `【图片锐化@图@sigma@threshold】` | 应用高斯模糊或锐化效果。 |
| `【图片变灰@图】` | 将图片转为灰度图。 |
| `【图片变圆@图】` | 将方形图片裁剪为圆形。 |
| `【圆角@图@左上@右上@右下@左下】` | 为图片添加圆角。 |
| `【图片遮罩@大图@小图@x@y】` | 使用小图作为遮罩层处理大图。 |
| `【图片蒙版@大图@小图@x@y】` | 使用小图作为蒙版层处理大图。 |
| **文字与SVG** | |
| `【图片嵌字@图@文字@x@y@大小@rgba@字体...】` | 在图片上绘制文字。 |
| `【文字转图片@宽@文字@大小@rgba@字体...】` | 将横排文字渲染成图片。 |
| `【竖文字转图片@高@文字@大小@rgba@字体...】` | 将竖排文字渲染成图片。 |
| `【默认字体】` | 下载并返回一个默认中文字体（Noto Sans SC）。 |
| `【svg渲染@svg文本】` | 将SVG代码渲染成PNG图片。 |
| **动态图处理** | |
| `【GIF/WEBP合成@图片数组@延时】` | 将一系列图片合成为GIF或WEBP动图。 |
| `【GIF/WEBP分解@gif/webp字节集】` | 将动图分解成PNG图片帧数组。 |

### 13. 系统与外部程序交互

| 命令 | 说明 |
| :--- | :--- |
| `【系统信息】` | 获取操作系统、硬件等信息。 |
| `【进程ID】` | 获取当前进程的ID。 |
| `【CPU使用】` / `【内存使用】` | 获取当前进程的CPU和内存占用。 |
| `【命令行@命令@编码】` | 执行系统命令并返回输出。 |
| `【启动@命令】` | 异步启动一个程序或打开文件/网页。 |
| `【截屏@显示器序号】` | 截取指定显示器的屏幕 (Windows)。 |
| `【设置桌面背景@图片路径】` | 设置Windows桌面背景。 |
| `【运行SQL@文件名@SQL语句@参数数组】` | 使用SQLite3引擎执行SQL。 |
| `【SQL修改数】` | 获取上一次 `运行SQL` 修改的行数。 |
| `【压缩@目录@压缩文件】` / `【解压@压缩文件@目录】` | 创建或解压7z压缩文件。 |
| `【运行PY@脚本@参数】` | 在独立的Python环境中执行脚本。 |
| `【快速运行PY@脚本@参数】` | 在共享的Python实例中执行脚本，速度更快。 |
| `【运行本地PY@脚本@参数】` | 使用系统本地安装的Python环境执行脚本。 |
| `【运行特殊PY@py目录@脚本@参数】` | 在指定的Python环境中运行脚本。 |
| `【运行lua@脚本】` / `【运行超级lua@脚本】` | 执行Lua脚本。 |

### 14. 脚本与并发控制

| 命令 | 说明 |
| :--- | :--- |
| `【运行脚本@内容@参数...】` | 在新环境中同步运行RedLang脚本。 |
| `【反射执行@内容】` | 在当前环境中同步运行RedLang脚本。 |
| `【后台运行脚本@内容@参数...】` | 在新环境中异步运行RedLang脚本，不阻塞。 |
| `【当前脚本】` | 获取当前运行脚本的名称。 |
| `【重定向@脚本名】` | 将当前事件交由另一个脚本处理。 |
| `【加锁@锁名】` / `【解锁@锁名】` | 对代码块进行加锁和解锁，用于并发控制。 |
| `【尝试加锁@锁名@失败执行】` | 尝试获取锁，如果失败则执行指定逻辑。 |
| `【发送信号@名@内容】` / `【等待信号@名@超时】` | 在包内进行简单的线程通信。 |
| `【执行频率@名@间隔@次数@失败返回】` | 限制某操作在单位时间内的执行次数。 |
| `【剩余次数】` | 在 `【执行频率】` 后使用，获取剩余可执行次数。 |

### 15. 杂项工具

| 命令 | 说明 |
| :--- | :--- |
| `【时间戳】` / `【13位时间戳】` | 获取当前10位或13位Unix时间戳。 |
| `【时间戳转文本@时间戳】` | 将时间戳转换为“年-月-日-时-分-秒”格式。 |
| `【文本转时间戳@文本】` | 将特定格式的时间文本转换为10位时间戳。 |
| `【读词库文件@路径】` | 读取特定格式的词库文件，返回对象。 |
| `【TTS@文本@音色】` | (即将弃用) 文本转语音。 |
| `【上传文件@字节集@文件名】` | 将文件上传到公共图床，返回链接。 |

---

## 三、 平台相关命令 (主要用于聊天机器人)

### 16. 来源与身份信息

| 命令 | 说明 |
| :--- | :--- |
| `【发送者ID】` | 获取消息发送者的唯一ID。 |
| `【当前群号】` | 获取消息所在的群号。 |
| `【当前群组】` | 获取消息所在的群组ID（用于多平台）。 |
| `【发送者昵称】` | 获取发送者的昵称或合适称呼。 |
| `【机器人ID】` | 获取当前机器人的ID。 |
| `【机器人名字】` | 获取机器人的名字。 |
| `【机器人平台】` | 获取产生事件的机器人平台（如 `qq`, `discord` 等）。 |

### 17. 权限与群管理

| 命令 | 说明 |
| :--- | :--- |
| `【发送者权限】` | 获取发送者在群内的权限（群主/管理/群员）。 |
| `【BOT权限】` | 获取机器人在群内的权限。 |
| `【禁言@秒数】` | 禁言当前消息的发送者（0为解禁）。 |
| `【同意@好友备注】` | 同意好友/加群请求。 |
| `【拒绝@拒绝理由】` | 拒绝好友/加群请求。 |
| `【设置主人@用户ID数组】` | 设置机器人的主人。 |
| `【主人数组】` | 获取所有主人的ID数组。 |
| `【主人@用户ID】` | 检查指定ID（默认为发送者）是否为主人，若不是则终止脚本。 |

### 18. 消息处理与交互

| 命令 | 说明 |
| :--- | :--- |
| `【当前消息】` | 获取当前消息的纯文本内容。 |
| `【子关键词】` | 获取消息中匹配关键词后的剩余部分。 |
| `【消息ID】` / `【消息ID@用户ID】` | 获取当前消息ID，或某用户最近的消息ID数组。 |
| `【获取消息@消息ID】` | 根据ID获取历史消息内容。 |
| `【撤回@消息ID/ID数组】` | 撤回指定消息（或当前消息）。 |
| `【输出流@内容】` | 发送一条消息并返回其消息ID。 |
| `【分页】` | 在此命令之后的内容将作为一条新消息发送。 |
| `【清空】` | (不推荐使用) 清空当前待发送的消息。 |
| `【艾特】` / `【艾特@用户ID】` | At消息发送者或指定用户。 |
| `【表情回应@emoji/ID@消息ID】` | 对指定消息（或当前消息）进行表情回应。 |
| `【输入流@超时】` | 等待并获取当前发送者的下一条消息。 |
| `【群输入流@超时】` | 等待并获取当前群内的下一条消息及其发送者信息。 |
| `【设置来源@键@值】` | 为定时任务等无来源的事件设置一个回复目标。 |

### 19. CQ码与消息内容解析

| 命令 | 说明 |
| :--- | :--- |
| `【CQ码解析@CQ码文本】` | 将单个CQ码解析为对象。 |
| `【CQ解析@消息文本】` | 将包含CQ码的消息解析为对象数组。 |
| `【CQ转义】` / `【CQ反转义】` / `【CQ码转义】` | 处理OneBot消息格式中的特殊字符转义。 |
| `【取艾特@CQ文本】` | 从消息中提取所有被At用户的ID数组。 |
| `【取回复ID@CQ文本】` | 从消息中提取回复的消息ID。 |
| `【取图片@CQ文本】` | 从消息中提取所有图片的URL数组。 |
| `【取文本@CQ文本】` | 从消息中提取所有纯文本部分，返回数组。 |

### 20. 媒体发送

| 命令 | 说明 |
| :--- | :--- |
| `【图片@链接/路径/字节集@不缓存】` | 发送图片。 |
| `【设置图片参数@key@val】` | 为 `【图片】` 命令附加额外参数（如 `summary`）。 |
| `【语音@链接/路径/字节集@不缓存】` | 发送语音。 |
| `【视频@链接/路径/字节集@不缓存】` | 发送视频。 |

### 21. 信息获取

| 命令 | 说明 |
| :--- | :--- |
| `【取群列表】` | 获取机器人加入的群列表。 |
| `【取发送者信息】` | 获取发送者的详细信息。 |
| `【取头像@用户ID】` | 获取指定用户（默认发送者）的头像URL。 |
| `【事件内容】` | 获取触发当前脚本的完整OneBot事件JSON对象。 |

### 22. 积分系统

| 命令 | 说明 |
| :--- | :--- |
| `【积分】` | 获取发送者在当前群的积分。 |
| `【积分-增加@分数】` | 增加或减少发送者的积分。 |
| `【积分-设置@分数】` | 直接设置发送者的积分。 |
| `【积分-排行@数目】` | 获取当前群的积分排行榜。 |

### 23. 底层与高级

| 命令 | 说明 |
| :--- | :--- |
| `【OB调用@OneBot JSON】` | 直接向OneBot协议端发送API调用请求。 |
| `【伪造OB事件@OneBot JSON】` | 向红色问答注入一个伪造的OneBot事件。 |
| `【脚本输出@消息ID】` | 获取由某条消息触发的脚本所发出的消息ID。 |
| `【脚本输出-增加ID@消息ID】` | 手动关联一条消息ID到当前触发源。 |

---

## 四、 触发方式与事件

### 事件关键词
*   **触发类型：** `事件触发`
*   **关键词格式：** 遵循OneBot事件名称，如 `notice:notify:poke` (戳一戳)，`notice:group_recall` (群消息撤回)，`request:group:add` (加群请求)。

### CRON 表达式
*   **触发类型：** `CRON定时器`
*   **关键词格式：** 标准的CRON表达式，如 `0 0 8 * * ?` (每天早上8点)。
*   **注意：** 定时器中发消息需先用 `【设置来源】` 指定目标。

### 特殊事件
*   **框架初始化：** 框架启动或保存时执行，用于定义全局常量、命令等。
*   **脚本错误：** 任何脚本执行出错时触发，可通过 `【错误信息】` 获取详情。
*   **群成员增加：** 新人入群时触发，`【发送者ID】` 和 `【发送者昵称】` 指向新成员。

### 网络触发
*   **触发类型：** `网络触发`
*   **URL格式：** `http://host:port/user/包名/自定义路径`
*   **关键词：** `/自定义路径`
*   **专用命令：**
    *   `【网络-访问参数】`
    *   `【网络-访问体】`
    *   `【网络-访问头】`
    *   `【网络-设置返回头@key@val】`
    *   `【网络-访问方法】`
    *   `【网络-权限】`

### 内容过滤与全局设置
*   **内容过滤：** 若脚本返回 `真`，则当前包的其它脚本不再处理此事件。
*   **全局过滤器/初始化器：** 在WebUI中设置，作用于所有包，并优先执行。